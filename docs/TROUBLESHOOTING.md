# Troubleshooting Backup & Restore

## Error 400 Bad Request

### Causes of Error 400

Error 400 Bad Request usually occurs due to:

1. **GENERATED COLUMNS** - Columns automatically generated by the database
   - Example: `booking_number` in `booking_hajj` table (GENERATED COLUMN with `DEFAULT booking_code`)
   - Cannot be manually inserted, must be excluded during restore

2. **IDENTITY COLUMNS** - ID columns automatically generated
   - Example: `id` in `room_allotments` table (GENERATED ALWAYS AS IDENTITY)
   - Cannot be manually inserted, must be excluded during restore

### Solutions Already Implemented

The backup program automatically handles these columns by:

1. **Excluding Generated Columns** during restore:
   - `booking_hajj`: exclude `booking_number`
   - `room_allotments`: exclude `id`

2. **Auto-filter** columns that cannot be inserted before restore

### Affected Tables

| Table | Excluded Column | Reason |
|-------|----------------|--------|
| `booking_hajj` | `booking_number` | GENERATED COLUMN (default from `booking_code`) |
| `room_allotments` | `id` | GENERATED ALWAYS AS IDENTITY |

### Verification

After restore, these columns will be automatically generated by the database with appropriate values.

## Other Errors

### Error: "duplicate key value violates unique constraint"

**Cause**: Data already exists in database with the same ID.

**Solution**: The program already uses UPSERT (update or insert) to handle this. If error persists, check for other unique constraints.

### Error: "foreign key constraint violation"

**Cause**: Referenced ID does not exist in parent table.

**Solution**: Ensure restore is done in correct order (parent tables first, then child tables).

### Error: "column does not exist"

**Cause**: Database schema changed or column was removed.

**Solution**: Update backup script to exclude columns that no longer exist.

## Tips

1. **Always backup before restore** - For safety
2. **Check restore log** - To see which tables had errors
3. **Verify data after restore** - Ensure row counts match
4. **Test restore in development first** - Before restoring in production
